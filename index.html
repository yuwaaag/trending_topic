<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>PTN News - Safe Live</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: sans-serif; color: white; }
        .studio { position: relative; width: 100vw; height: 100vh; background: url('studio.jpg') center/cover; }
        .news-img { position: absolute; left: 5%; top: 10%; width: 40%; height: 40%; border: 4px solid #00f2ff; border-radius: 12px; overflow: hidden; background: #111; }
        .analysis { position: absolute; left: 5%; bottom: 8%; width: 45%; height: 35%; background: rgba(0,8,20,0.9); border-left: 10px solid red; padding: 20px; box-sizing: border-box; overflow-y: auto; }
        .anchor { position: absolute; right: 0; bottom: 0; width: 50%; height: 95%; }
        video { width: 100%; height: 100%; object-fit: contain; }
    </style>
</head>
<body>

<div class="studio">
    <div class="news-img"><img id="newsImg" src="" style="width:100%; height:100%; object-fit:cover;"></div>
    <div class="analysis">
        <h1 id="title" style="color:#00f2ff; font-size: 28px; margin:0;">PTN NEWS</h1>
        <p id="msg" style="font-size: 24px; color: yellow;">GitHub पर अपडेट हो गया है! <br>शुरू करने के लिए यहाँ क्लिक करें।</p>
    </div>
    <div class="anchor">
        <video id="vid" muted loop><source src="anchor_video.mp4" type="video/mp4"></video>
    </div>
</div>

<script type="importmap">
  { "imports": { "@google/generative-ai": "https://esm.run/@google/generative-ai" } }
</script>

<script type="module">
    import { GoogleGenerativeAI } from "@google/generative-ai";

    let safeKey = ""; 

    window.runPTN = async function() {
        if (!safeKey) {
            safeKey = prompt("सुरक्षा के लिए अपनी Gemini API Key यहाँ डालें (GitHub इसे नहीं देख पाएगा):");
            if (!safeKey) return;
        }

        const msgBox = document.getElementById("msg");
        msgBox.innerText = "Gemini 1.5 Flash से ताज़ा खबरें लोड हो रही हैं...";

        try {
            const genAI = new GoogleGenerativeAI(safeKey);
            const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });

            // स्टेप 1: खबर ढूँढना
            const res = await model.generateContent("Give me 1 trending news headline in India. Just the name.");
            const topic = (await res.response).text().trim();
            
            document.getElementById("title").innerText = "BREAKING: " + topic;
            document.getElementById("newsImg").src = `https://image.pollinations.ai/prompt/news%20on%20${encodeURIComponent(topic)}?nologo=true`;

            // स्टेप 2: विश्लेषण
            const analysisRes = await model.generateContent(`Aap professional news analyst hain. Topic "${topic}" par 100 words ka Hindi analysis likhein. Namaskar se shuru karein.`);
            const finalTxt = (await analysisRes.response).text();
            
            speakNow(finalTxt);
        } catch (err) {
            console.error(err);
            alert("Error: शायद Key गलत है या ब्लॉक हो गई है।");
            safeKey = ""; 
        }
    }

    function speakNow(txt) {
        document.getElementById("msg").innerText = txt;
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(txt);
        msg.lang = 'hi-IN';
        msg.rate = 0.92;
        const v = document.getElementById("vid");
        msg.onstart = () => v.play();
        msg.onend = () => { v.pause(); setTimeout(window.runPTN, 15000); };
        window.speechSynthesis.speak(msg);
    }

    // इवेंट लिसनर
    window.addEventListener('click', () => {
        if (typeof window.runPTN === "function") window.runPTN();
    });
</script>
</body>
</html>
