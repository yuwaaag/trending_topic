<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>PTN News - Full Success</title>
    <style>
        :root { --accent: #00f2ff; --twitter: #1DA1F2; }
        body, html { margin: 0; padding: 0; width: 1920px; height: 1080px; overflow: hidden; background: #000; font-family: 'Arial', sans-serif; color: white; }
        
        /* Studio Background */
        .studio-bg { position: absolute; width: 100%; height: 100%; background: url('studio.jpg') no-repeat center center; background-size: cover; z-index: 1; }
        
        /* Photo Display Unit */
        .display-unit { position: absolute; left: 80px; top: 120px; width: 850px; height: 500px; border: 5px solid var(--accent); z-index: 10; border-radius: 20px; overflow: hidden; background: #111; box-shadow: 0 0 50px rgba(0,242,255,0.4); }
        #trendImg { width: 100%; height: 100%; object-fit: cover; }
        
        /* News Script Box */
        .analysis-box { position: absolute; left: 80px; bottom: 80px; width: 800px; background: rgba(0, 5, 20, 0.95); border-left: 15px solid var(--twitter); padding: 35px; font-size: 42px; z-index: 15; border-radius: 0 30px 30px 0; line-height: 1.5; font-weight: bold; min-height: 220px; }

        /* Anchor Video Container */
        .anchor-container { position: absolute; right: 0; bottom: 0; width: 950px; height: 1080px; z-index: 5; }
        #anchorVideo { width: 100%; height: 100%; object-fit: contain; }
    </style>
</head>
<body>

<div class="studio-bg"></div>

<div class="display-unit">
    <img id="trendImg" src="https://via.placeholder.com/850x500/000/fff?text=Waiting+for+AI...">
    <div id="trendTitle" style="position:absolute; bottom:0; width:100%; background:rgba(0,0,0,0.85); padding:20px; font-size:40px; border-top:2px solid var(--accent);">‡§ú‡•Å‡•ú ‡§∞‡§π‡§æ ‡§π‡•à...</div>
</div>

<div class="analysis-box" id="analysisText">‡§®‡•ç‡§Ø‡•Ç‡§ú‡§º ‡§∞‡•Ç‡§Æ ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•à‡•§ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è 'Interact' ‡§¶‡§¨‡§æ‡§ï‡§∞ ‡§Ø‡§π‡§æ‡§Å ‡§è‡§ï ‡§¨‡§æ‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§</div>

<div class="anchor-container">
    <video id="anchorVideo" muted loop playsinline><source src="anchor_video.mp4" type="video/mp4"></video>
</div>

<script>
    // üî¥ ‡§Ø‡§π‡§æ‡§Å ‡§Ö‡§™‡§®‡•Ä ‡§∏‡§π‡•Ä ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏ ‡§≠‡§∞‡•á‡§Ç
    const API_KEY = "AIzaSyBUGHUmJMdxTvDLTrBtiLTN3jZUQ4dspCo"; 
    const SHEET_ID = '1rybhbksHooXt_n1X9xOhvE8ilVneK1V4wx_NHXVlfIo';
    const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv`;

    let newsItems = [];
    let currentIdx = 0;

    // 1. ‡§ó‡•Ç‡§ó‡§≤ ‡§∂‡•Ä‡§ü ‡§∏‡•á ‡§°‡•á‡§ü‡§æ ‡§≤‡§æ‡§®‡§æ
    async function startApp() {
        try {
            const res = await fetch(CSV_URL + '&cb=' + Date.now());
            const text = await res.text();
            newsItems = text.split('\n').slice(1).map(r => r.split(',')[0].replace(/"/g, "").trim()).filter(r => r.length > 2);
            
            if(newsItems.length > 0) processNews();
            else document.getElementById('analysisText').innerText = "Sheet ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§ü‡•â‡§™‡§ø‡§ï ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ!";
        } catch (e) { 
            document.getElementById('analysisText').innerText = "Sheet Error: ‡§≤‡§ø‡§Ç‡§ï ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§"; 
        }
    }

    // 2. Gemini AI ‡§∏‡•á ‡§®‡•ç‡§Ø‡•Ç‡§ú‡§º ‡§≤‡§ø‡§ñ‡§µ‡§æ‡§®‡§æ
    async function processNews() {
        const topic = newsItems[currentIdx];
        document.getElementById('trendTitle').innerText = topic;
        document.getElementById('analysisText').innerText = "AI ‡§®‡•ç‡§Ø‡•Ç‡§ú‡§º ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•à...";
        
        // ‡§´‡•ã‡§ü‡•ã ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡§æ (‡§Ø‡§π ‡§Ö‡§¨ ‡§ï‡§æ‡§Æ ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•à)
        document.getElementById('trendImg').src = `https://image.pollinations.ai/prompt/news%20scene%20of%20${encodeURIComponent(topic)}?width=850&height=500&nologo=true`;

        // üü¢ FIX: ‡§∏‡§π‡•Ä API URL ‡§î‡§∞ Model Name
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;
        
        const payload = {
            contents: [{ parts: [{ text: `Aap ek professional news anchor hain. Topic "${topic}" par 3 line ki news report Hindi mein likhein. Simple aur damdar Hindi honi chahiye. Sirf news likhein.` }] }]
        };

        try {
            const response = await fetch(url, { method: 'POST', body: JSON.stringify(payload), headers: { 'Content-Type': 'application/json' } });
            const data = await response.json();
            
            if (data.candidates && data.candidates[0].content) {
                const script = data.candidates[0].content.parts[0].text.trim();
                document.getElementById('analysisText').innerText = script;
                speak(script); // ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡§æ
            } else {
                throw new Error("API Failure");
            }
        } catch (e) { 
            document.getElementById('analysisText').innerText = "AI ‡§µ‡•ç‡§Ø‡§∏‡•ç‡§§ ‡§π‡•à, 5 ‡§∏‡•á‡§ï‡§Ç‡§° ‡§Æ‡•á‡§Ç ‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ ‡§ï‡•ã‡§∂‡§ø‡§∂...";
            setTimeout(processNews, 5000);
        }
    }

    // 3. ‡§®‡•ç‡§Ø‡•Ç‡§ú‡§º ‡§™‡•ù‡§®‡§æ (Awaaz)
    function speak(text) {
        window.speechSynthesis.cancel(); // ‡§™‡•Å‡§∞‡§æ‡§®‡•Ä ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'hi-IN';
        msg.rate = 0.95; // ‡§¨‡•ã‡§≤‡§®‡•á ‡§ï‡•Ä ‡§∞‡•û‡•ç‡§§‡§æ‡§∞
        
        const video = document.getElementById('anchorVideo');
        
        msg.onstart = () => video.play(); // ‡§¨‡•ã‡§≤‡§®‡§æ ‡§∂‡•Å‡§∞‡•Ç ‡§§‡•ã ‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§∂‡•Å‡§∞‡•Ç
        msg.onend = () => {
            video.pause(); // ‡§¨‡•ã‡§≤‡§®‡§æ ‡§ñ‡§§‡•ç‡§Æ ‡§§‡•ã ‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§¨‡§Ç‡§¶
            currentIdx = (currentIdx + 1) % newsItems.length; // ‡§Ö‡§ó‡§≤‡•Ä ‡§®‡•ç‡§Ø‡•Ç‡§ú‡§º
            setTimeout(processNews, 8000); // 8 ‡§∏‡•á‡§ï‡§Ç‡§° ‡§ï‡§æ ‡§¨‡•ç‡§∞‡•á‡§ï
        };
        window.speechSynthesis.speak(msg);
    }

    // üî¥ ‡§ú‡§º‡§∞‡•Ç‡§∞‡•Ä: OBS ‡§Æ‡•á‡§Ç ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§®‡•á ‡§™‡§∞ ‡§π‡•Ä ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã‡§ó‡§æ
    window.onclick = () => startApp();
</script>
</body>
</html>
