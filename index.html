<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <style>
        :root { --accent: #00f2ff; --twitter: #1DA1F2; }
        body, html { margin: 0; padding: 0; width: 1920px; height: 1080px; overflow: hidden; background: #000; font-family: 'Oswald', sans-serif; color: white; }
        .studio-bg { position: absolute; width: 100%; height: 100%; background: url('studio.jpg') no-repeat center center; background-size: cover; z-index: 1; }
        .display-unit { position: absolute; left: 80px; top: 120px; width: 850px; height: 500px; border: 5px solid var(--accent); z-index: 10; border-radius: 20px; overflow: hidden; background: #000; }
        #trendImg { width: 100%; height: 100%; object-fit: cover; }
        .analysis-box { position: absolute; left: 80px; bottom: 80px; width: 800px; background: rgba(0, 5, 15, 0.9); border-left: 10px solid var(--twitter); padding: 30px; font-size: 35px; z-index: 15; border-radius: 0 30px 30px 0; }
        .anchor-container { position: absolute; right: 0; bottom: 0; width: 950px; height: 1000px; z-index: 5; }
        #anchorVideo { width: 100%; height: 100%; object-fit: contain; }
    </style>
</head>
<body>

<div class="studio-bg"></div>
<div class="display-unit">
    <img id="trendImg" src="">
    <div id="trendTitle" style="position:absolute; bottom:0; width:100%; background:rgba(0,0,0,0.8); padding:15px; font-size:40px;">Loading...</div>
</div>
<div class="analysis-box" id="analysisText">‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç...</div>
<div class="anchor-container"><video id="anchorVideo" muted loop playsinline><source src="anchor_video.mp4" type="video/mp4"></video></div>

<script>
    // üî¥ ‡§Ö‡§™‡§®‡•Ä ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏ ‡§≠‡§∞‡•á‡§Ç
    const API_KEY = "AIzaSyBUGHUmJMdxTvDLTrBtiLTN3jZUQ4dspCo"; 
    const SHEET_ID = '1rybhbksHooXt_n1X9xOhvE8ilVneK1V4wx_NHXVlfIo';
    const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv`;

    let topics = [];
    let idx = 0;

    async function start() {
        try {
            const res = await fetch(CSV_URL + '&cb=' + Date.now());
            const text = await res.text();
            topics = text.split('\n').slice(1).map(r => r.split(',')[0].replace(/"/g, "").trim()).filter(r => r !== "" && r !== "Topic");
            if(topics.length > 0) callGemini();
            else document.getElementById('analysisText').innerText = "Sheet ‡§ñ‡§æ‡§≤‡•Ä ‡§π‡•à ‡§Ø‡§æ ‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü ‡§ó‡§≤‡§§ ‡§π‡•à!";
        } catch (e) { document.getElementById('analysisText').innerText = "Sheet Error! Check ID and Sharing."; }
    }

    async function callGemini() {
        const topic = topics[idx];
        document.getElementById('trendTitle').innerText = topic;
        document.getElementById('analysisText').innerText = "AI ‡§®‡•ç‡§Ø‡•Ç‡§ú‡§º ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•à...";

        // üü¢ FIX: ‡§≤‡•á‡§ü‡•á‡§∏‡•ç‡§ü gemini-1.5-flash-latest ‡§á‡§∏‡•ç‡§§‡•á‡§Æ‡§æ‡§≤ ‡§ï‡§ø‡§Ø‡§æ ‡§π‡•à
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${API_KEY}`;
        
        const payload = {
            contents: [{ parts: [{ text: `Topic: "${topic}". Act as News Anchor. Write 3 lines in Hindi. Format: Keyword|Hashtag|Script` }] }]
        };

        try {
            const response = await fetch(url, {
                method: 'POST',
                body: JSON.stringify(payload),
                headers: { 'Content-Type': 'application/json' }
            });

            const data = await response.json();
            
            if(data.error) {
                // ‡§Ö‡§ó‡§∞ 1.5-latest ‡§≠‡•Ä ‡§® ‡§ö‡§≤‡•á ‡§§‡•ã 1.5-flash ‡§ü‡•ç‡§∞‡§æ‡§à ‡§ï‡§∞‡•á‡§ó‡§æ
                document.getElementById('analysisText').innerText = "API Error: " + data.error.message;
                return;
            }

            const raw = data.candidates[0].content.parts[0].text;
            const parts = raw.split('|');
            
            const kw = parts[0] || "news";
            const script = parts[2] || raw;
            
            document.getElementById('analysisText').innerText = script.trim();
            document.getElementById('trendImg').src = `https://source.unsplash.com/1600x900/?${kw.trim()}`;
            
            speak(script.trim());
        } catch (e) { document.getElementById('analysisText').innerText = "Connection Error! Internet ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§"; }
    }

    function speak(t) {
        window.speechSynthesis.cancel();
        const m = new SpeechSynthesisUtterance(t);
        m.lang = 'hi-IN';
        m.onstart = () => document.getElementById('anchorVideo').play();
        m.onend = () => {
            document.getElementById('anchorVideo').pause();
            idx = (idx + 1) % topics.length;
            setTimeout(callGemini, 5000); 
        };
        window.speechSynthesis.speak(m);
    }

    window.onclick = () => start();
</script>
</body>
</html>
