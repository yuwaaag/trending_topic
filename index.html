<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>PTN News Secure System</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: sans-serif; }
        .studio-container { position: relative; width: 100vw; height: 100vh; background: url('studio.jpg') no-repeat center center; background-size: cover; }
        .news-window { position: absolute; left: 5%; top: 10%; width: 40%; height: 40%; border: 4px solid #00f2ff; border-radius: 12px; overflow: hidden; z-index: 10; }
        #newsImg { width: 100%; height: 100%; object-fit: cover; }
        .analysis-box { position: absolute; left: 5%; bottom: 8%; width: 45%; height: 35%; background: rgba(0, 8, 20, 0.9); border-left: 12px solid #ff0000; padding: 25px; z-index: 20; box-sizing: border-box; color: white; }
        #content { font-size: 26px; line-height: 1.5; overflow-y: auto; height: 80%; }
        .anchor-box { position: absolute; right: 0; bottom: 0; width: 50%; height: 95%; z-index: 5; }
        video { width: 100%; height: 100%; object-fit: contain; }
    </style>
</head>
<body>

<div class="studio-container">
    <div class="news-window"><img id="newsImg" src=""></div>
    <div class="analysis-box">
        <h1 id="headline" style="color:#00f2ff; font-size: 32px; margin:0;">PTN NEWS</h1>
        <div id="content" style="color: yellow; margin-top:10px;">की (Key) डालने के लिए स्क्रीन पर क्लिक करें।</div>
    </div>
    <div class="anchor-box">
        <video id="anchorVid" muted loop><source src="anchor_video.mp4" type="video/mp4"></video>
    </div>
</div>

<script type="importmap">
  {
    "imports": {
      "@google/generative-ai": "https://esm.run/@google/generative-ai"
    }
  }
</script>

<script type="module">
    import { GoogleGenerativeAI } from "@google/generative-ai";

    let API_KEY = "";

    window.startSecureSystem = async function() {
        // अगर की (Key) नहीं है, तो पूछें
        if (!API_KEY) {
            API_KEY = prompt("सुरक्षा के लिए अपनी Gemini API Key यहाँ डालें:");
            if (!API_KEY) return alert("Key के बिना सिस्टम नहीं चलेगा!");
        }

        const responseDiv = document.getElementById("content");
        responseDiv.innerText = "सुरक्षित कनेक्शन बनाया जा रहा है...";

        try {
            const genAI = new GoogleGenerativeAI(API_KEY);
            const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });

            // स्टेप 1: खबर खोजना
            const topicResult = await model.generateContent("Give me 1 major trending news headline in India today.");
            const topic = topicResult.response.text().trim();
            document.getElementById("headline").innerText = "ब्रेकिंग: " + topic;
            document.getElementById('newsImg').src = `https://image.pollinations.ai/prompt/news%20on%20${encodeURIComponent(topic)}?nologo=true`;

            // स्टेप 2: विश्लेषण
            const analysisResult = await model.generateContent(`Aap PTN News analyst hain. Topic "${topic}" par 100 words ka Hindi analysis likhein.`);
            const text = analysisResult.response.text();
            
            speak(text);
        } catch (error) {
            alert("गलत API Key या कनेक्शन एरर!");
            API_KEY = ""; // गलत की होने पर रिसेट करें
        }
    }

    function speak(txt) {
        document.getElementById('content').innerText = txt;
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(txt);
        msg.lang = 'hi-IN';
        const v = document.getElementById('anchorVid');
        msg.onstart = () => v.play();
        msg.onend = () => { v.pause(); setTimeout(window.startSecureSystem, 15000); };
        window.speechSynthesis.speak(msg);
    }

    window.onclick = () => window.startSecureSystem();
</script>
</body>
</html>
