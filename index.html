<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>PTN News - Final Fix</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: sans-serif; color: white; }
        .studio { position: relative; width: 100vw; height: 100vh; background: url('studio.jpg') center/cover; background-color: #111; }
        .news-img { position: absolute; left: 5%; top: 10%; width: 40%; height: 40%; border: 3px solid #00f2ff; border-radius: 10px; overflow: hidden; }
        .analysis { position: absolute; left: 5%; bottom: 5%; width: 45%; height: 40%; background: rgba(0,8,20,0.95); border-left: 10px solid red; padding: 20px; box-sizing: border-box; overflow-y: auto; }
        .anchor { position: absolute; right: 0; bottom: 0; width: 50%; height: 95%; }
        video { width: 100%; height: 100%; object-fit: contain; }
    </style>
</head>
<body>

<div class="studio">
    <div class="news-img"><img id="newsImg" src="" style="width:100%; height:100%; object-fit:cover;"></div>
    <div class="analysis">
        <h1 id="title" style="color:#00f2ff; font-size: 26px; margin:0;">PTN NEWS</h1>
        <p id="msg" style="font-size: 22px; color: yellow;">सिस्टम तैयार है। शुरू करने के लिए यहाँ क्लिक करें।</p>
    </div>
    <div class="anchor">
        <video id="vid" muted loop><source src="anchor_video.mp4" type="video/mp4"></video>
    </div>
</div>

<script>
    let myApiKey = "";

    async function runNewsSystem() {
        if (!myApiKey) {
            myApiKey = prompt("अपनी नई API Key यहाँ डालें:");
            if (!myApiKey) return;
        }

        const msgBox = document.getElementById("msg");
        msgBox.innerText = "AI से ताज़ा खबरें लोड की जा रही हैं...";

        // Google Gemini API का सीधा (Direct) कॉल
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${myApiKey}`;

        const payload = {
            contents: [{
                parts: [{ text: "Aap ek professional news anchor hain. India ki aaj ki 1 badi trending news ka title aur uska 80 words mein Hindi analysis likhein. Output format: Title: [Headline] Analysis: [Text]" }]
            }]
        };

        try {
            const response = await fetch(url, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            const data = await response.json();
            
            if (data.error) {
                throw new Error(data.error.message);
            }

            const rawText = data.candidates[0].content.parts[0].text;
            
            // डेटा को अलग-अलग करना
            const titlePart = rawText.split("Analysis:")[0].replace("Title:", "").trim();
            const analysisPart = rawText.split("Analysis:")[1].trim();

            document.getElementById("title").innerText = "ब्रेकिंग: " + titlePart;
            document.getElementById("newsImg").src = `https://image.pollinations.ai/prompt/news%20visual%20for%20${encodeURIComponent(titlePart)}?nologo=true`;
            
            startBroadcasting(analysisPart);

        } catch (error) {
            msgBox.innerHTML = `<span style="color:red;">एरर: ${error.message}</span><br>कृपया नई Key आज़माएँ।`;
            myApiKey = ""; 
        }
    }

    function startBroadcasting(txt) {
        document.getElementById("msg").innerText = txt;
        window.speechSynthesis.cancel();
        const speech = new SpeechSynthesisUtterance(txt);
        speech.lang = 'hi-IN';
        speech.rate = 0.95;

        const video = document.getElementById("vid");
        speech.onstart = () => video.play();
        speech.onend = () => {
            video.pause();
            setTimeout(runNewsSystem, 15000); 
        };
        window.speechSynthesis.speak(speech);
    }

    window.onclick = () => runNewsSystem();
</script>
</body>
</html>
