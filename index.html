<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>PTN News - Deep Analysis Version</title>
    <style>
        :root { --accent: #00f2ff; }
        body, html { margin: 0; padding: 0; width: 1920px; height: 1080px; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; color: white; }
        .studio-bg { position: absolute; width: 100%; height: 100%; background: url('studio.jpg') no-repeat center center; background-size: cover; z-index: 1; }
        .display-unit { position: absolute; left: 80px; top: 100px; width: 880px; height: 520px; border: 4px solid var(--accent); z-index: 10; border-radius: 15px; overflow: hidden; background: #111; box-shadow: 0 0 40px rgba(0,242,255,0.3); }
        #trendImg { width: 100%; height: 100%; object-fit: cover; }
        
        /* Analysis Box: Screen पर केवल मुख्य बिंदु दिखेंगे */
        .analysis-box { position: absolute; left: 80px; bottom: 60px; width: 850px; background: rgba(0, 8, 25, 0.95); border-left: 12px solid #1DA1F2; padding: 35px; font-size: 32px; z-index: 15; border-radius: 0 25px 25px 0; line-height: 1.5; font-weight: 600; min-height: 300px; box-sizing: border-box; }
        
        .anchor-container { position: absolute; right: 0; bottom: 0; width: 950px; height: 1080px; z-index: 5; }
        #anchorVideo { width: 100%; height: 100%; object-fit: contain; }
    </style>
</head>
<body>

<div class="studio-bg"></div>
<div class="display-unit">
    <img id="trendImg" src="">
    <div id="trendTitle" style="position:absolute; bottom:0; width:100%; background:rgba(0,0,0,0.85); padding:15px; font-size:35px; border-top:2px solid var(--accent); color: var(--accent);">विशेष विश्लेषण</div>
</div>

<div class="analysis-box" id="analysisText">PTN न्यूज़ रूम तैयार है... कृपया क्लिक करें।</div>

<div class="anchor-container">
    <video id="anchorVideo" muted loop playsinline><source src="anchor_video.mp4" type="video/mp4"></video>
</div>

<script>
    const API_KEY = "AIzaSyBUGHUmJMdxTvDLTrBtiLTN3jZUQ4dspCo"; 
    const SHEET_ID = '1rybhbksHooXt_n1X9xOhvE8ilVneK1V4wx_NHXVlfIo';
    const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv`;

    let newsItems = [];
    let currentIdx = 0;

    async function startNews() {
        try {
            const res = await fetch(CSV_URL + '&cb=' + Date.now());
            const text = await res.text();
            newsItems = text.split('\n').slice(1).map(r => r.split(',')[0].replace(/"/g, "").trim()).filter(r => r.length > 2);
            if(newsItems.length > 0) processTopic();
        } catch (e) { console.log("Sheet Error"); }
    }

    async function processTopic() {
        const topic = newsItems[currentIdx];
        document.getElementById('trendTitle').innerText = topic;
        document.getElementById('analysisText').innerText = "AI इस विषय का गहरा विश्लेषण (Deep Analysis) तैयार कर रहा है...";
        document.getElementById('trendImg').src = `https://image.pollinations.ai/prompt/news%20infographic%20of%20${encodeURIComponent(topic)}?width=880&height=520&nologo=true`;

        // लेटेस्ट Gemini 2.0 Flash का इस्तेमाल
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${API_KEY}`;
        
        const payload = {
            contents: [{ parts: [{ text: `Act as a Senior News Analyst. Topic: "${topic}". 
            Task: Write a detailed Hindi news analysis. 
            Structure: 
            1. Start with 'Namaskar, PTN News ke vishesh vishleshan mein aapka swagat hai'.
            2. Explain what is happening currently.
            3. Explain why this is important for the audience.
            4. Provide 2-3 deep insights or facts related to it.
            5. Conclusion: What to expect in future.
            Length: At least 150-200 words. 
            Note: Use professional Hindi (no English words). Provide ONLY the Hindi text.` }] }]
        };

        try {
            const response = await fetch(url, { method: 'POST', body: JSON.stringify(payload), headers: { 'Content-Type': 'application/json' } });
            const data = await response.json();
            
            if (data.candidates && data.candidates[0].content) {
                const fullScript = data.candidates[0].content.parts[0].text.trim();
                
                // स्क्रीन पर केवल पहली 3-4 लाइनें दिखाएंगे ताकि गंदा न लगे, लेकिन एंकर पूरा पढ़ेगा
                const shortText = fullScript.split('।').slice(0, 3).join('।') + '...';
                document.getElementById('analysisText').innerText = shortText;
                
                speak(fullScript); 
            }
        } catch (e) {
            console.log("API Error");
            setTimeout(processTopic, 5000);
        }
    }

    function speak(txt) {
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(txt);
        msg.lang = 'hi-IN';
        msg.rate = 0.88; // न्यूज़ विश्लेषण के लिए थोड़ी गंभीर और धीमी रफ़्तार
        msg.pitch = 1.0;
        
        const video = document.getElementById('anchorVideo');
        msg.onstart = () => video.play();
        msg.onend = () => {
            video.pause();
            currentIdx = (currentIdx + 1) % newsItems.length;
            setTimeout(processTopic, 12000); // विश्लेषण के बाद 12 सेकंड का ब्रेक
        };
        window.speechSynthesis.speak(msg);
    }

    window.onclick = () => startNews();
</script>
</body>
</html>
