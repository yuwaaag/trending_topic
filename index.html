<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>PTN News Live - Chroma Fix</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: 'Segoe UI', Arial, sans-serif; color: white; }
        
        .studio { 
            position: relative; 
            width: 100vw; 
            height: 100vh; 
            background: url('studio.jpg') center/cover no-repeat; 
        }

        .visual-box { 
            position: absolute; right: 5%; top: 12%; width: 42%; height: 40%; 
            border: 4px solid #00f2ff; border-radius: 12px; overflow: hidden; 
            box-shadow: 0 0 30px rgba(0, 242, 255, 0.5); z-index: 5;
        }
        #newsImg { width: 100%; height: 100%; object-fit: cover; transition: all 1s ease-in-out; }

        .script-box { 
            position: absolute; left: 3%; top: 12%; width: 45%; height: 60%; 
            background: rgba(0, 0, 0, 0.7); border-left: 8px solid #ff0000; 
            padding: 25px; box-sizing: border-box; z-index: 5; overflow: hidden;
        }
        #teleprompter { font-size: 30px; line-height: 1.5; color: #fff; font-weight: 500; }

        /* ‡§è‡§Ç‡§ï‡§∞ ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§î‡§∞ ‡§ï‡•à‡§®‡§µ‡§∏ */
        .anchor-container { 
            position: absolute; 
            right: 0; 
            bottom: 0; 
            width: 60%; /* ‡§ú‡§º‡§∞‡•Ç‡§∞‡§§ ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§¨‡§¶‡§≤‡•á‡§Ç */
            height: 100%; 
            z-index: 10; 
            pointer-events: none; 
            display: flex;
            justify-content: flex-end;
            align-items: flex-end;
        }
        #anchorCanvas { 
            max-width: 100%; 
            max-height: 100%; 
            object-fit: contain;
        }

        .ticker-bar { 
            position: absolute; bottom: 0; width: 100%; height: 85px; 
            background: linear-gradient(90deg, #ff0000, #800000); 
            display: flex; align-items: center; z-index: 20; border-top: 4px solid #fff; 
        }
        .ticker-text { font-size: 38px; font-weight: bold; width: 100%; }
        
        /* ‡§Ö‡§∏‡§≤‡•Ä ‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§ï‡•ã ‡§õ‡•Å‡§™‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è */
        #anchorVid { display: none; }
    </style>
</head>
<body>

<div class="studio">
    <div class="visual-box">
        <img id="newsImg" src="">
    </div>

    <div class="script-box">
        <div id="teleprompter">PTN NEWS: ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§π‡•Ä‡§Ç ‡§≠‡•Ä ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç...</div>
    </div>

    <div class="anchor-container">
        <canvas id="anchorCanvas"></canvas>
    </div>

    <video id="anchorVid" muted loop crossorigin="anonymous">
        <source src="anchor_video.mp4" type="video/mp4">
    </video>

    <div class="ticker-bar">
        <marquee scrollamount="12" id="flashTicker">PTN NEWS: ‡§∏‡§§‡•ç‡§Ø‡§§‡§æ ‡§π‡•Ä ‡§π‡§Æ‡§æ‡§∞‡•Ä ‡§™‡§π‡§ö‡§æ‡§®...</marquee>
    </div>
</div>

<script>
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTUiuIw7nxC0DQyICk9XkUU1OWSyy-5pOfqjtdcMdyBrsMnQKuoQb5_tgAd0B_KiKXsiVvq_cXGbro9/pub?output=csv";

    let newsItems = [];
    let newsIndex = 0;

    const video = document.getElementById("anchorVid");
    const canvas = document.getElementById("anchorCanvas");
    const ctx = canvas.getContext("2d", { willReadFrequently: true });

    // üü¢ ‡§ó‡•ç‡§∞‡•Ä‡§® ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§π‡§ü‡§æ‡§®‡•á ‡§ï‡§æ ‡§Æ‡§æ‡§∏‡•ç‡§ü‡§∞ ‡§´‡§Ç‡§ï‡•ç‡§∂‡§®
    function processChromaKey() {
        if (video.paused || video.ended) return;

        // ‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§ï‡•á ‡§´‡•ç‡§∞‡•á‡§Æ ‡§ï‡•ã ‡§ï‡•à‡§®‡§µ‡§∏ ‡§™‡§∞ ‡§ñ‡•Ä‡§Ç‡§ö‡§®‡§æ
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        // ‡§™‡§ø‡§ï‡•ç‡§∏‡•á‡§≤ ‡§°‡•á‡§ü‡§æ ‡§®‡§ø‡§ï‡§æ‡§≤‡§®‡§æ
        let frame = ctx.getImageData(0, 0, canvas.width, canvas.height);
        let length = frame.data.length / 4;

        for (let i = 0; i < length; i++) {
            let r = frame.data[i * 4 + 0];
            let g = frame.data[i * 4 + 1];
            let b = frame.data[i * 4 + 2];

            // ‡§Ö‡§ó‡§∞ ‡§π‡§∞‡§æ ‡§∞‡§Ç‡§ó (Green) ‡§è‡§ï ‡§∏‡•Ä‡§Æ‡§æ ‡§∏‡•á ‡§ú‡§º‡•ç‡§Ø‡§æ‡§¶‡§æ ‡§π‡•à, ‡§§‡•ã ‡§â‡§∏‡•á ‡§ó‡§æ‡§Ø‡§¨ (Transparent) ‡§ï‡§∞ ‡§¶‡•ã
            if (g > 100 && g > r * 1.3 && g > b * 1.3) {
                frame.data[i * 4 + 3] = 0; // Alpha (‡§™‡§æ‡§∞‡§¶‡§∞‡•ç‡§∂‡§ø‡§§‡§æ) = 0
            }
        }
        // ‡§¨‡§¶‡§≤‡§æ ‡§π‡•Å‡§Ü ‡§°‡•á‡§ü‡§æ ‡§µ‡§æ‡§™‡§∏ ‡§ï‡•à‡§®‡§µ‡§∏ ‡§™‡§∞ ‡§°‡§æ‡§≤‡§®‡§æ
        ctx.putImageData(frame, 0, 0);
        requestAnimationFrame(processChromaKey);
    }

    async function loadNews() {
        try {
            const response = await fetch(csvUrl);
            const data = await response.text();
            const rows = data.split('\n').slice(1); 
            newsItems = rows.map(row => {
                const parts = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                return {
                    script: parts[0]?.replace(/"/g, ""),
                    visual: parts[1]?.replace(/"/g, ""),
                    flash: parts[2]?.replace(/"/g, "")
                };
            }).filter(item => item.script);

            playNews();
        } catch (e) {
            document.getElementById("teleprompter").innerText = "Error: ‡§∂‡•Ä‡§ü ‡§≤‡§ø‡§Ç‡§ï ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç!";
        }
    }

    function playNews() {
        if (newsItems.length === 0) return;
        const current = newsItems[newsIndex];

        document.getElementById("teleprompter").innerText = current.script;
        document.getElementById("flashTicker").innerText = "BREAKING NEWS: " + current.flash;
        
        const img = document.getElementById("newsImg");
        img.src = `https://image.pollinations.ai/prompt/professional%20news%20visual%20of%20${encodeURIComponent(current.visual)}?nologo=true&seed=${Math.random()}`;

        window.speechSynthesis.cancel();
        const speech = new SpeechSynthesisUtterance(current.script);
        speech.lang = 'hi-IN';
        speech.rate = 0.95;

        speech.onstart = () => {
            video.play();
            // ‡§ï‡•à‡§®‡§µ‡§∏ ‡§ï‡§æ ‡§∏‡§æ‡§á‡•õ ‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§ï‡•á ‡§¨‡§∞‡§æ‡§¨‡§∞ ‡§ï‡§∞‡§®‡§æ
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            processChromaKey();
        };

        speech.onend = () => {
            video.pause();
            newsIndex = (newsIndex + 1) % newsItems.length;
            setTimeout(playNews, 3000);
        };

        window.speechSynthesis.speak(speech);
    }

    window.onclick = () => {
        if (newsItems.length === 0) loadNews();
    };
</script>

</body>
</html>
